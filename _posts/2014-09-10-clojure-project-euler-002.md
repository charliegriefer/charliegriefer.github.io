---
layout: post
title: "Project Euler: Problem 2 in Clojure"
description: "My attempt at solving Project Euler's problem #2 using Clojure"

tags: [clojure, programming, project euler]
comments: true
---

<p>
<b>Even Fibonacci numbers</b>
<br /><br />
Each new term in the Fibonacci sequence is generated by adding the previous two terms. By starting with 1 and 2, the first 10 terms will be:  
<br /><br />
1, 2, 3, 5, 8, 13, 21, 34, 55, 89, ...    
<br /><br />
By considering the terms in the Fibonacci sequence whose values do not exceed four million, find the sum of the even-valued terms.
</p>
{: .notice}

While working through [Programming Clojure](http://pragprog.com/book/shcloj/programming-clojure), there were a few examples of generating the Fibonacci sequence. I remembered that there were some straightforward examples that didn't scale well, and ultimately a "good" version that I didn't think I'd be able to write from scratch.

I decided to focus on the part of the problem that summed the even Fibonacci values below four million. And with that decision, I set out to find a Clojure implementation for generating the Fibonacci sequence that I felt comfortable with.

I found one that looked good in the ClojureDocs page for [iterate](http://clojuredocs.org/clojure_core/clojure.core/iterate).

{% highlight Clojure %}
(def fib (map first (iterate (fn [[a b]] [b (+ a b)]) [0 1])))
{% endhighlight %}

I liked this one because it was concise and looked "functional". I didn't fully understand it at first, but I wanted to before moving forward. 

As per the documentation for `(iterate)`:

> (iterate f x)  
Returns a lazy sequence of x, (f x), (f (f x)) etc. f must be free of side-effects

OK. `(iterate)` takes a function, and an _x_. 
 
Looking first at the function:

{% highlight Clojure %}
(fn [[a b]] [b (+ a b)])
{% endhighlight %}

The function takes a single argument, which is a _vector_ that holds two elements. Presumably, two numeric values. The function body is straightforward, and returns a vector of two elements where:

- element 1 is the 2nd element from the argument vector
- element 2 is the sum of the 1st and 2nd elements from the argument vector

Passing [1 2] would return [2 3].

The _x_, in this case, is the vector [0 1]. Clearly, that's the seed to kick off the Fibonacci sequence. 

Calling `(iterate)` with the function `(fn [[a b]] [b (+ a b)])` and the x `[0 1]` yields:

{% raw %}
    ([0 1] [1 1] [1 2] [2 3] [3 5] [5 8] [8 13] [13 21] [21 34] [34 55])
{% endraw %}

Taking the _first_ element from each vector gives you the true Fibonacci sequence of `0 1 1 2 3 5 8 13 21 34...`

Notice that `1` appears twice. Not really an issue for us, as our problem is looking explicitly for _even_ numbers in the sequence. But it made me realize that the problem definition specified _starting with 1 and 2_. With that in mind, I updated the _x_ value of our `(iterate)` to be `[1 2]` rather than `[0 1]`.

The new `(iterate)` function:

{% highlight Clojure %}
(iterate (fn [[a b]] [b (+ a b)]) [1 2])

(take 10 (iterate (fn [[a b]] [b (+a b)]) [1 2]))  
;; => ([1 2] [2 3] [3 5] [5 8] [8 13] [13 21] [21 34] [34 55] [55 89] [89 144])
{% endhighlight %}

The rest of the `(fib)` function is pretty straightforward. We only need the _first_ element from each of the vectors returned from the `(iterate)` function. `(map)` the `(first)` function over that collection.

{% highlight Clojure %}
(def fibs (map first (iterate (fn [[a b]] [b (+ a b)]) [1 2])))
{% endhighlight %}

With that in place, the solution isn't too far removed from the solution I used for [Problem 1](/2014/09/10-clojure-project-euler-001). Filter out the even values under four million:

{% highlight Clojure %}
(filter #(and (< % 4000000) (even? %)) coll)
{% endhighlight %}

...and sum them using `(apply +)`.

The final implementation (also available as a [Gist](https://gist.github.com/charliegriefer/37aaf467ab2942bb2757)):

{% highlight Clojure %}
(def fibs (map first (iterate (fn [[a b]] [b (+ a b)]) [1 2])))

(apply + (filter #(and (< % 4000000) (even? %)) fibs))

;; => 4613732
{% endhighlight %}
